{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PawConnect - Animal Rescue & Adoption</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- FontAwesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="{% static 'favicon.svg' %}">
    <link rel="shortcut icon" href="{% static 'favicon.svg' %}">

    <!-- External CSS -->
    <link rel="stylesheet" href="{% static 'accounts/variables.css' %}">
    <link rel="stylesheet" href="{% static 'accounts/components.css' %}">
    <link rel="stylesheet" href="{% static 'accounts/main.css' %}">
    
</head>
<style>

body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 0;
}

    .hero-content h1, h2 {
        color: #ffffff;
        animation: fadeInDown 2s ease-out;
    }
    
    .hero-content p {

        animation: fadeInUp 2.5s ease-out;
    }

    .btn-hero {

        transition: transform 0.3s ease, background-color 0.3s ease;
        animation: zoomIn 2.5s ease-out;
    }

    .btn-hero:hover {
        transform: scale(1.1);

    }

    /* âœ¨ Keyframes */
    @keyframes fadeInDown {
        from {
            opacity: 0;
            transform: translateY(-40px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(40px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes zoomIn {
        from {
            opacity: 0;
            transform: scale(0.7);
        }

        to {
            opacity: 1;
            transform: scale(1);
        }
    }

    
/* Chat appearance is managed centrally in `static/accounts/main.css`. */

/* Toast Notification Styling */
.toast {
    min-width: 350px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    border-radius: 12px;
    overflow: hidden;
    animation: slideInRight 0.4s ease-out;
    border: none;
}

.toast-header {
    border-bottom: none;
    padding: 12px 16px;
    font-weight: 600;
}

.toast-body {
    border-radius: 0 0 12px 12px;
}

@keyframes slideInRight {
    from {
        opacity: 0;
        transform: translateX(100px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

@media (max-width: 576px) {
    .toast {
        min-width: 280px;
    }
}

</style>
<body>

    <!-- New Modern Navbar -->
    <nav class="navbar-modern navbar-expand-lg sticky-top">
      <div class="container">
        <!-- Logo -->
        <a class="navbar-brand-modern" href="{% url 'base' %}">
          <i class="fa-solid fa-paw"></i>
          <span>PawConnect</span>
        </a>
        
        <!-- Mobile Toggle -->
        <button class="navbar-toggler-modern" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
          <span></span>
          <span></span>
          <span></span>
        </button>
        
        <!-- Navigation Menu -->
        <div class="collapse navbar-collapse justify-content-center" id="navbarNav">
          <ul class="navbar-nav-modern">
            <li><a href="#home" class="nav-link-modern active">HOME</a></li>
            <li><a href="{% url 'adoption_section' %}" class="nav-link-modern">ADOPT</a></li>
            <li><a href="#sos" class="nav-link-modern">RESCUE</a></li>
            <li><a href="{% url 'volunteer_apply' %}" class="nav-link-modern">VOLUNTEER</a></li>
            <li><a href="{% url 'donate' %}" class="nav-link-modern">DONATE</a></li>
          </ul>
        </div>
        
        <!-- Right Actions -->
        <div class="navbar-actions">
          {% if user.is_authenticated %}
            <a href="{% url 'profile' %}" class="icon-btn"><i class="fa-solid fa-user"></i></a>
            <a href="{% url 'logout' %}" class="btn-donate">Logout</a>
          {% else %}
            <a href="{% url 'login' %}" class="icon-btn"><i class="fa-solid fa-user"></i></a>
            <a href="{% url 'signup' %}" class="btn-donate">Sign Up</a>
          {% endif %}
        </div>
      </div>
    </nav>

    <!-- Toast Notification Container -->
    <div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 99999; margin-top: 70px; pointer-events: none;">
        {% if messages %}
            {% for message in messages %}
                <div class="toast show" role="alert" aria-live="assertive" aria-atomic="true" data-bs-autohide="true" data-bs-delay="3000" style="pointer-events: auto;">
                    <div class="toast-header" style="background: {% if message.tags == 'success' %}linear-gradient(135deg, #20c997, #17a589){% elif message.tags == 'error' or message.tags == 'danger' %}linear-gradient(135deg, #ef4444, #dc2626){% elif message.tags == 'warning' %}linear-gradient(135deg, #f59e0b, #d97706){% else %}linear-gradient(135deg, #3b82f6, #2563eb){% endif %}; color: white; border: none;">
                        <i class="fa-solid {% if message.tags == 'success' %}fa-check-circle{% elif message.tags == 'error' or message.tags == 'danger' %}fa-exclamation-circle{% elif message.tags == 'warning' %}fa-exclamation-triangle{% else %}fa-info-circle{% endif %} me-2"></i>
                        <strong class="me-auto">{% if message.tags == 'success' %}Success{% elif message.tags == 'error' or message.tags == 'danger' %}Error{% elif message.tags == 'warning' %}Warning{% else %}Info{% endif %}</strong>
                        <small>Just now</small>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                    <div class="toast-body" style="background: white; color: #1f2937; font-weight: 500; padding: 15px;">
                        {{ message }}
                    </div>
                </div>
            {% endfor %}
        {% endif %}
    </div>

    <!-- Modern Hero Section -->
    <section id="home" class="hero-modern">
        <div class="container">
            <div class="row align-items-center">
                <!-- Left Content -->
                <div class="col-lg-6">
                    <div class="hero-text">
                        <p class="hero-subtitle"><i class="fa-solid fa-paw"></i> Welcome to PawConnect</p>
                        <h1 class="hero-title">
                            <i class="fa-solid fa-heart"></i> Giving <span class="highlight">Animals</span> a Second<br>
                            <span class="highlight">Chance</span>
                        </h1>
                        <p style="font-size: 18px; color: #555; margin-bottom: 30px;">Join our mission to rescue, rehabilitate, and rehome animals in need across the country.</p>
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <a href="{% url 'adoption_section' %}" class="btn-hero-modern">
                                <i class="fa-solid fa-dog"></i> Adopt a Pet
                            </a>
                            <a href="#sos" class="btn-hero-modern" style="background: #dc3545;">
                                <i class="fa-solid fa-triangle-exclamation"></i> Report SOS
                            </a>
                        </div>
                    </div>
                </div>
                
                <!-- Right Image -->
                <div class="col-lg-6">
                    <div class="hero-image">
                        <div class="image-blob"></div>
                        <img src="https://images.unsplash.com/photo-1543466835-00a7907e9de1?w=600&h=600&fit=crop" alt="Happy Pet" class="dog-image">
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Pets Waiting for Homes Section -->
    <section id="adoption" class="section" style="background: #ffffff; padding: 80px 0;">
        <div class="container">
        <div class="text-center mb-5">
            <p style="color: #94a3b8; font-size: 0.95rem; margin-bottom: 12px; letter-spacing: 1px;">Meet the animals</p>
            <h2 style="font-size: 2.5rem; font-weight: 700; color: #1a374d; margin-bottom: 15px; font-family: 'Fredoka One', cursive;">Puppies Waiting for Adoption</h2>
            <p style="color: #64748b; font-size: 1rem; max-width: 700px; margin: 0 auto;">The best overall dog DNA test is Embark Breed & Health Kit (view at Chewy), which provides you with a breed brwn and information most dogs</p>
        </div>
        
        <div class="row g-4" style="margin-top: 50px;">
            {% for pet in featured_pets %}
            <div class="col-md-4">
                <div style="background: white; border-radius: 16px; overflow: hidden; box-shadow: 0 2px 12px rgba(0,0,0,0.06); transition: all 0.3s ease; border: 1px solid #f1f5f9;" onmouseover="this.style.transform='translateY(-8px)'; this.style.boxShadow='0 12px 28px rgba(0,0,0,0.12)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 12px rgba(0,0,0,0.06)'">
                    <div style="background: #f8fafc; padding: 30px; text-align: center; border-bottom: 1px solid #e2e8f0;">
                        <img src="{{ pet.image }}" style="width: 100%; max-width: 280px; height: 280px; object-fit: cover; border-radius: 12px;" alt="{{ pet.name }}">
                    </div>
                    <div style="padding: 25px;">
                        <h5 style="font-size: 1.1rem; font-weight: 500; color: #1e293b; margin-bottom: 12px; line-height: 1.5;">
                            {% if pet.name == 'Buddy' %}
                                <span style="font-weight: 600;">MK007</span> <span style="color: #64748b; font-weight: 400;">-</span> {{ pet.name }} <span style="color: #94a3b8; font-size: 0.95rem;">(Golden Retriever)</span>
                            {% elif pet.name == 'Mittens' %}
                                <span style="font-weight: 600;">JH645</span> <span style="color: #64748b; font-weight: 400;">-</span> {{ pet.name }} <span style="color: #94a3b8; font-size: 0.95rem;">(Persian)</span>
                            {% else %}
                                <span style="font-weight: 600;">RB123</span> <span style="color: #64748b; font-weight: 400;">-</span> {{ pet.name }} <span style="color: #94a3b8; font-size: 0.95rem;">(Lop Ear)</span>
                            {% endif %}
                        </h5>
                        <p style="color: #64748b; font-size: 0.95rem; margin-bottom: 15px;">
                            <span style="margin-right: 15px;">Genre: {{ pet.gender }}</span> â€¢ 
                            <span style="margin-left: 5px;">Age: {{ pet.age }} {% if pet.age == 1 %}year{% else %}years{% endif %}</span>
                        </p>
                        <div style="border-top: 1px solid #f1f5f9; padding-top: 18px; margin-top: 15px; display: flex; justify-content: space-between; align-items: center;">
                            <p style="font-size: 1.3rem; font-weight: 700; color: #1a374d; margin: 0;">Free Adoption</p>
                            <div style="display: flex; gap: 8px;">
                                <a href="{% url 'adoption_section' %}" style="background: #20c997; color: white; padding: 10px 20px; border-radius: 8px; text-decoration: none; font-size: 0.9rem; font-weight: 600; transition: all 0.3s ease; display: inline-block;" onmouseover="this.style.background='#17a589'; this.style.transform='translateY(-2px)'" onmouseout="this.style.background='#20c997'; this.style.transform='translateY(0)'"><i class="fa-solid fa-heart"></i> Adopt</a>
                                <a href="{% url 'donate' %}" style="background: #f1f5f9; color: #64748b; padding: 10px 20px; border-radius: 8px; text-decoration: none; font-size: 0.9rem; font-weight: 600; transition: all 0.3s ease; display: inline-block;" onmouseover="this.style.background='#e2e8f0'" onmouseout="this.style.background='#f1f5f9'"><i class="fa-regular fa-star"></i> Sponsor</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="col-12 text-center">
                <p class="text-muted">No pets available for adoption at the moment. Check back soon!</p>
            </div>
            {% endfor %}
        </div>
        
        <div class="text-center" style="margin-top: 60px;">
            <a href="{% url 'adoption_section' %}" style="background: linear-gradient(135deg, #20c997 0%, #17a589 100%); color: white; padding: 16px 40px; border-radius: 12px; text-decoration: none; font-size: 1.1rem; font-weight: 600; display: inline-flex; align-items: center; gap: 10px; box-shadow: 0 8px 20px rgba(32, 201, 151, 0.25); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 12px 30px rgba(32, 201, 151, 0.35)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 8px 20px rgba(32, 201, 151, 0.25)'"><i class="fa-solid fa-paw"></i> View All Available Pets</a>
        </div>
        </div>
    </section>

    <!-- News Feed Section -->
    <section class="section" style="background: #f8fafc; padding: 80px 0;">
        <div class="container">
            <div class="text-center mb-5">
                <p style="color: #94a3b8; font-size: 0.95rem; margin-bottom: 12px; letter-spacing: 1px;">LATEST UPDATES</p>
                <h2 style="font-size: 2.5rem; font-weight: 700; color: #1a374d; margin-bottom: 15px; font-family: 'Fredoka One', cursive;">Our Recent Activities</h2>
                <p style="color: #64748b; font-size: 1rem; max-width: 700px; margin: 0 auto;">Stay updated with our latest rescue missions, adoption events, and community initiatives</p>
            </div>

            <div class="news-carousel-container" style="position: relative; margin-top: 50px; overflow: hidden;">
                <div class="news-carousel" id="newsCarousel" style="display: flex; gap: 24px; transition: transform 0.5s ease;">
                    {% for news in news_items %}
                    <div class="news-card" style="min-width: calc(33.333% - 16px); background: white; border-radius: 16px; overflow: hidden; box-shadow: 0 4px 16px rgba(0,0,0,0.08); cursor: pointer; transition: all 0.3s ease;" 
                         onclick="openNewsModal('{{ news.title|escapejs }}', '{{ news.description|escapejs }}', '{{ news.image.url }}')"
                         onmouseover="this.style.transform='translateY(-8px)'; this.style.boxShadow='0 12px 28px rgba(0,0,0,0.15)'"
                         onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 16px rgba(0,0,0,0.08)'">
                        <div style="position: relative; overflow: hidden; height: 250px;">
                            <img src="{{ news.image.url }}" alt="{{ news.title }}" style="width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s ease;"
                                 onmouseover="this.style.transform='scale(1.05)'"
                                 onmouseout="this.style.transform='scale(1)'">
                            <div style="position: absolute; top: 15px; right: 15px; background: rgba(32, 201, 151, 0.95); color: white; padding: 8px 16px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; backdrop-filter: blur(10px);">
                                <i class="fa-solid fa-calendar"></i> {{ news.created_at|date:"M d, Y" }}
                            </div>
                        </div>
                        <div style="padding: 25px;">
                            <h5 style="font-size: 1.2rem; font-weight: 700; color: #1a374d; margin-bottom: 12px; line-height: 1.4;">{{ news.title }}</h5>
                            <p style="color: #64748b; font-size: 0.95rem; line-height: 1.6; margin-bottom: 0; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden;">{{ news.description|truncatewords:25 }}</p>
                            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #f1f5f9;">
                                <span style="color: #20c997; font-weight: 600; font-size: 0.9rem; display: inline-flex; align-items: center; gap: 8px;">
                                    Read More <i class="fa-solid fa-arrow-right"></i>
                                </span>
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <div class="col-12 text-center">
                        <p style="color: #94a3b8; font-size: 1.1rem;">No news available at the moment.</p>
                    </div>
                    {% endfor %}
                </div>
                
                {% if news_items|length > 3 %}
                <!-- Navigation Arrows -->
                <button onclick="scrollNews(-1)" style="position: absolute; left: -20px; top: 50%; transform: translateY(-50%); background: white; border: none; width: 50px; height: 50px; border-radius: 50%; box-shadow: 0 4px 12px rgba(0,0,0,0.15); cursor: pointer; z-index: 10; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center;"
                        onmouseover="this.style.background='#20c997'; this.style.color='white'; this.style.transform='translateY(-50%) scale(1.1)'"
                        onmouseout="this.style.background='white'; this.style.color='#1a374d'; this.style.transform='translateY(-50%) scale(1)'">
                    <i class="fa-solid fa-chevron-left" style="font-size: 1.2rem; color: #1a374d;"></i>
                </button>
                <button onclick="scrollNews(1)" style="position: absolute; right: -20px; top: 50%; transform: translateY(-50%); background: white; border: none; width: 50px; height: 50px; border-radius: 50%; box-shadow: 0 4px 12px rgba(0,0,0,0.15); cursor: pointer; z-index: 10; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center;"
                        onmouseover="this.style.background='#20c997'; this.style.color='white'; this.style.transform='translateY(-50%) scale(1.1)'"
                        onmouseout="this.style.background='white'; this.style.color='#1a374d'; this.style.transform='translateY(-50%) scale(1)'">
                    <i class="fa-solid fa-chevron-right" style="font-size: 1.2rem; color: #1a374d;"></i>
                </button>
                {% endif %}
            </div>

            <!-- Carousel Indicators -->
            {% if news_items|length > 3 %}
            <div style="display: flex; justify-content: center; gap: 10px; margin-top: 40px;">
                <div class="carousel-dot active" onclick="goToSlide(0)" style="width: 12px; height: 12px; border-radius: 50%; background: #20c997; cursor: pointer; transition: all 0.3s ease;"></div>
                {% for i in "123456789" %}
                    {% if forloop.counter < news_items|length|add:"-2" %}
                    <div class="carousel-dot" onclick="goToSlide({{ forloop.counter }})" style="width: 12px; height: 12px; border-radius: 50%; background: #cbd5e1; cursor: pointer; transition: all 0.3s ease;"></div>
                    {% endif %}
                {% endfor %}
            </div>
            {% endif %}
        </div>
    </section>

    <!-- News Modal -->
    <div id="newsModal" style="display: none; position: fixed; z-index: 10000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); padding: 20px; overflow-y: auto;">
        <div style="position: relative; background: white; max-width: 900px; margin: 50px auto; border-radius: 20px; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
            <button onclick="closeNewsModal()" style="position: absolute; top: 20px; right: 20px; background: rgba(255,255,255,0.95); border: none; width: 45px; height: 45px; border-radius: 50%; cursor: pointer; z-index: 10; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(0,0,0,0.15); transition: all 0.3s ease;"
                    onmouseover="this.style.background='#dc3545'; this.querySelector('i').style.color='white'; this.style.transform='rotate(90deg)'"
                    onmouseout="this.style.background='rgba(255,255,255,0.95)'; this.querySelector('i').style.color='#1a374d'; this.style.transform='rotate(0)'">
                <i class="fa-solid fa-times" style="font-size: 1.3rem; color: #1a374d; transition: color 0.3s ease;"></i>
            </button>
            <img id="modalImage" src="" alt="" style="width: 100%; height: 450px; object-fit: cover;">
            <div style="padding: 50px;">
                <h2 id="modalTitle" style="font-size: 2rem; font-weight: 700; color: #1a374d; margin-bottom: 20px; font-family: 'Fredoka One', cursive;"></h2>
                <p id="modalDescription" style="color: #64748b; font-size: 1.05rem; line-height: 1.8;"></p>
            </div>
        </div>
    </div>

    <script>
    let currentSlide = 0;
    const newsCards = document.querySelectorAll('.news-card');
    const totalSlides = Math.max(0, newsCards.length - 2);
    
    function scrollNews(direction) {
        currentSlide += direction;
        if (currentSlide < 0) currentSlide = totalSlides;
        if (currentSlide > totalSlides) currentSlide = 0;
        
        const carousel = document.getElementById('newsCarousel');
        const cardWidth = newsCards[0]?.offsetWidth || 0;
        const gap = 24;
        const offset = -(currentSlide * (cardWidth + gap));
        carousel.style.transform = `translateX(${offset}px)`;
        
        updateDots();
    }
    
    function goToSlide(index) {
        currentSlide = index;
        const carousel = document.getElementById('newsCarousel');
        const cardWidth = newsCards[0]?.offsetWidth || 0;
        const gap = 24;
        const offset = -(currentSlide * (cardWidth + gap));
        carousel.style.transform = `translateX(${offset}px)`;
        
        updateDots();
    }
    
    function updateDots() {
        const dots = document.querySelectorAll('.carousel-dot');
        dots.forEach((dot, index) => {
            if (index === currentSlide) {
                dot.style.background = '#20c997';
                dot.style.width = '32px';
            } else {
                dot.style.background = '#cbd5e1';
                dot.style.width = '12px';
            }
        });
    }
    
    // Auto-scroll every 5 seconds
    setInterval(() => {
        if (newsCards.length > 3) {
            scrollNews(1);
        }
    }, 5000);
    
    function openNewsModal(title, description, image) {
        document.getElementById('modalTitle').textContent = title;
        document.getElementById('modalDescription').textContent = description;
        document.getElementById('modalImage').src = image;
        document.getElementById('newsModal').style.display = 'block';
        document.body.style.overflow = 'hidden';
    }
    
    function closeNewsModal() {
        document.getElementById('newsModal').style.display = 'none';
        document.body.style.overflow = 'auto';
    }
    
    // Close modal on outside click
    document.getElementById('newsModal')?.addEventListener('click', function(e) {
        if (e.target === this) {
            closeNewsModal();
        }
    });
    
    // Close modal on ESC key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeNewsModal();
        }
    });
    </script>

    <!-- Rescue SOS Section -->
<section id="sos" class="section section-light-gray">
    <div class="container">
        <div class="contact-modern-wrapper">
            <div class="row g-0">
                <!-- LEFT SIDE: Rescue Form -->
                <div class="col-lg-6">
                    <div class="contact-form-section">
                        {% if user.is_authenticated %}
                        <form method="POST" enctype="multipart/form-data" action="{% url 'submit_rescue_request' %}">
                            {% csrf_token %}
                            <div class="form-group">
                                <label>Your Name</label>
                                <input type="text" name="name" class="form-control-modern" placeholder="Your Name" required>
                            </div>
                            
                            <div class="form-group">
                                <label>Phone Number</label>
                                <input type="tel" name="phone" class="form-control-modern" placeholder="Phone Number" required>
                            </div>
                            
                            <div class="form-group">
                                <label>Exact Location</label>
                                <input type="text" name="location" class="form-control-modern" placeholder="Street, City" required>
                            </div>
                            
                            <div class="form-group">
                                <label>Type of Emergency</label>
                                <select name="emergency_type" class="form-control-modern" required>
                                    <option value="">-- Select Emergency Type --</option>
                                    <option value="injury">Injured Animal</option>
                                    <option value="abuse">Abuse/Neglect</option>
                                    <option value="abandoned">Abandoned Animal</option>
                                    <option value="trapped">Trapped Animal</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>Situation Description</label>
                                <textarea name="description" class="form-control-modern" rows="4" placeholder="Please describe the animal(s) and situation in detail" required></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label>Upload Photo (Optional)</label>
                                <input class="form-control-modern" type="file" name="photo" id="photo">
                            </div>
                            
                            <button type="submit" class="btn-contact-submit">
                                Submit Rescue Request
                            </button>
                        </form>
                        {% else %}
                            <p class="text-danger text-center">Please <a href="{% url 'login' %}">login</a> to report an animal in need.</p>
                        {% endif %}
                    </div>
                </div>
                
                <!-- RIGHT SIDE: Rescue Info -->
                <div class="col-lg-6">
                    <div class="contact-info-section">
                        <h2 class="contact-heading">Emergency Animal Rescue</h2>
                        <p class="contact-description">
                            Report injured, abused, or abandoned animals in your area. Our team will respond as quickly as possible to provide assistance.
                        </p>
                        
                        <div class="contact-details">
                            <div class="contact-item">
                                <div class="contact-icon" style="background-color: #dc3545;">
                                    <i class="fa-solid fa-phone"></i>
                                </div>
                                <div class="contact-text">
                                    <h6>Emergency Hotline</h6>
                                    <p>1-800-PAW-RESCUE<br>Available 24/7 in all regions</p>
                                </div>
                            </div>
                            
                            <div class="contact-item">
                                <div class="contact-icon" style="background-color: #dc3545;">
                                    <i class="fa-solid fa-triangle-exclamation"></i>
                                </div>
                                <div class="contact-text">
                                    <h6>When to Report</h6>
                                    <p>Visible injuries or illness<br>Abandoned or trapped animals<br>Suspected abuse or neglect<br>Animals in immediate danger</p>
                                </div>
                            </div>
                            
                            <div class="contact-item">
                                <div class="contact-icon" style="background-color: #dc3545;">
                                    <i class="fa-solid fa-clock"></i>
                                </div>
                                <div class="contact-text">
                                    <h6>Response Time</h6>
                                    <p>Emergency: Within 2 hours<br>Non-emergency: Within 24 hours</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

    <!-- Contact Section -->
<section id="contact" class="section section-light-gray">
    <div class="container">
        <div class="contact-modern-wrapper">
            <div class="row g-0">
                <!-- LEFT SIDE: Contact Form -->
                <div class="col-lg-6">
                    <div class="contact-form-section">
                        <!-- Success / Error Messages -->
                        {% if messages %}
                            {% for message in messages %}
                                <div class="alert alert-success alert-dismissible fade show" role="alert">
                                    {{ message }}
                                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                                </div>
                            {% endfor %}
                        {% endif %}

                        <form method="POST" action="#contact">
                            {% csrf_token %}
                            <div class="form-group">
                                <label>Your Name</label>
                                <input type="text" name="name" class="form-control-modern" placeholder="Your Name"
                                    value="{{ contact_form.name.value|default_if_none:'' }}" required>
                            </div>
                            
                            <div class="form-group">
                                <label>Your Email</label>
                                <input type="email" name="email" class="form-control-modern" placeholder="Your Email"
                                    value="{{ contact_form.email.value|default_if_none:'' }}" required>
                            </div>
                            
                            <div class="form-group">
                                <label>Subject</label>
                                <input type="text" name="subject" class="form-control-modern" placeholder="Subject"
                                    value="{{ contact_form.subject.value|default_if_none:'' }}">
                            </div>
                            
                            <div class="form-group">
                                <label>Regarding</label>
                                <select name="regarding" class="form-control-modern" required>
                                    <option value="">-- Select Topic --</option>
                                    <option value="adoption" {% if contact_form.data.regarding == "adoption" %}selected{% endif %}>Adoption Inquiry</option>
                                    <option value="volunteer" {% if contact_form.data.regarding == "volunteer" %}selected{% endif %}>Volunteer Information</option>
                                    <option value="donation" {% if contact_form.data.regarding == "donation" %}selected{% endif %}>Donation Question</option>
                                    <option value="general" {% if contact_form.data.regarding == "general" %}selected{% endif %}>General Question</option>
                                    <option value="other" {% if contact_form.data.regarding == "other" %}selected{% endif %}>Other</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>Your Message</label>
                                <textarea name="message" class="form-control-modern" rows="5" placeholder="Your Message" required>{{ contact_form.message.value }}</textarea>
                            </div>
                            
                            <button type="submit" class="btn-contact-submit">
                                Send Message
                            </button>
                        </form>
                    </div>
                </div>
                
                <!-- RIGHT SIDE: Contact Info -->
                <div class="col-lg-6">
                    <div class="contact-info-section">
                        <h2 class="contact-heading">Get In Touch</h2>
                        <p class="contact-description">
                            Submit the information and our program director will get back to you as soon as possible. Or call us at +977-1-5551234 to discuss immediate opportunities to get involved.
                        </p>
                        
                        <div class="contact-details">
                            <div class="contact-item">
                                <div class="contact-icon">
                                    <i class="fa-solid fa-phone"></i>
                                </div>
                                <div class="contact-text">
                                    <h6>Call Us</h6>
                                    <p>+977-1-5551234<br>+977-61-5555678</p>
                                </div>
                            </div>
                            
                            <div class="contact-item">
                                <div class="contact-icon">
                                    <i class="fa-solid fa-envelope"></i>
                                </div>
                                <div class="contact-text">
                                    <h6>Email Us</h6>
                                    <p>info@pawconnect.org.np<br>support@pawconnect.org.np</p>
                                </div>
                            </div>
                            
                            <div class="contact-item">
                                <div class="contact-icon">
                                    <i class="fa-solid fa-globe"></i>
                                </div>
                                <div class="contact-text">
                                    <h6>Website</h6>
                                    <p>www.pawconnect.org.np</p>
                                </div>
                            </div>
                            
                            <div class="contact-item">
                                <div class="contact-icon">
                                    <i class="fa-solid fa-location-dot"></i>
                                </div>
                                <div class="contact-text">
                                    <h6>Address</h6>
                                    <p>123 Animal Lane, Kathmandu 44600<br>Nepal</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="contact-social">
                            <h6>Follow Us On</h6>
                            <div class="contact-social-icons">
                                <a href="https://facebook.com/pawconnect" target="_blank"><i class="fa-brands fa-facebook-f"></i></a>
                                <a href="https://instagram.com/pawconnect" target="_blank"><i class="fa-brands fa-instagram"></i></a>
                                <a href="https://twitter.com/pawconnect" target="_blank"><i class="fa-brands fa-twitter"></i></a>
                                <a href="https://youtube.com/pawconnect" target="_blank"><i class="fa-brands fa-youtube"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

    <!-- Statistics Section -->
    <section class="stats-section">
        <div class="container">
            <div class="stats-wrapper">
                <div class="stats-header">
                    <h2 class="stats-title">Our Stats</h2>
                    <p class="stats-subtitle">We help you to unleash the power within your business</p>
                </div>
                <div class="stats-items">
                    <div class="stat-item">
                        <h3 class="stat-number">1,200+</h3>
                        <p class="stat-label">Animals Rescued</p>
                    </div>
                    <div class="stat-item">
                        <h3 class="stat-number">950+</h3>
                        <p class="stat-label">Successful Adoptions</p>
                    </div>
                    <div class="stat-item">
                        <h3 class="stat-number">300+</h3>
                        <p class="stat-label">Active Volunteers</p>
                    </div>
                    <div class="stat-item">
                        <h3 class="stat-number">500+</h3>
                        <p class="stat-label">Partners & Donors</p>
                    </div>
                    <div class="stat-item">
                        <h3 class="stat-number">NPR 5M+</h3>
                        <p class="stat-label">Funds Raised</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer-modern">
        <div class="footer-main">
            <div class="container">
                <div class="row">
                    <!-- Brand Section -->
                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="footer-brand">
                            <h3><i class="fa-solid fa-paw"></i> PawConnect</h3>
                            <p class="footer-slogan">Giving Animals a Second Chance</p>
                            <p class="footer-desc">Connecting loving homes with animals in need. Join our mission to rescue, rehabilitate, and rehome animals across Nepal.</p>
                            <div class="footer-social">
                                <a href="https://facebook.com/pawconnect" target="_blank"><i class="fa-brands fa-facebook-f"></i></a>
                                <a href="https://twitter.com/pawconnect" target="_blank"><i class="fa-brands fa-twitter"></i></a>
                                <a href="https://instagram.com/pawconnect" target="_blank"><i class="fa-brands fa-instagram"></i></a>
                                <a href="https://youtube.com/pawconnect" target="_blank"><i class="fa-brands fa-youtube"></i></a>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Links -->
                    <div class="col-lg-2 col-md-6 mb-4">
                        <h5 class="footer-heading">Quick Links</h5>
                        <ul class="footer-list">
                            <li><a href="#home">Home</a></li>
                            <li><a href="{% url 'adoption_section' %}">Adopt</a></li>
                            <li><a href="#sos">Rescue SOS</a></li>
                            <li><a href="{% url 'volunteer_apply' %}">Volunteer</a></li>
                            <li><a href="{% url 'donate' %}">Donate</a></li>
                        </ul>
                    </div>
                    
                    <!-- Get Involved -->
                    <div class="col-lg-2 col-md-6 mb-4">
                        <h5 class="footer-heading">Get Involved</h5>
                        <ul class="footer-list">
                            <li><a href="{% url 'adoption_section' %}">Available Pets</a></li>
                            <li><a href="{% url 'volunteer_apply' %}">Become Volunteer</a></li>
                            <li><a href="{% url 'volunteer_apply' %}">Foster Care</a></li>
                            <li><a href="{% url 'donate' %}">Make Donation</a></li>
                            <li><a href="{% url 'donate' %}">Sponsor Animal</a></li>
                        </ul>
                    </div>
                    
                    <!-- Services -->
                    <div class="col-lg-2 col-md-6 mb-4">
                        <h5 class="footer-heading">Services</h5>
                        <ul class="footer-list">
                            <li><a href="{% url 'adoption_section' %}">Pet Adoption</a></li>
                            <li><a href="#sos">Emergency Rescue</a></li>
                            <li><a href="{% url 'volunteer_apply' %}">Volunteering</a></li>
                            <li><a href="{% url 'donate' %}">Sponsorship</a></li>
                            <li><a href="#">Pet Care Tips</a></li>
                        </ul>
                    </div>
                    
                    <!-- Contact & Map -->
                    <div class="col-lg-3 col-md-6 mb-4">
                        <h5 class="footer-heading">Contact</h5>
                        <ul class="footer-list contact-list">
                            <li>
                                <strong>Call:</strong><br>
                                <a href="tel:+977-1-4444444">+977-1-4444444</a>
                            </li>
                            <li>
                                <strong>Email:</strong><br>
                                <a href="mailto:info@pawconnect.org">info@pawconnect.org</a>
                            </li>
                        </ul>
                        <div class="footer-map">
                            <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d14130.863763049562!2d85.32395!3d27.7172!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x39eb198a307baabf%3A0xb5137c1bf18db1ea!2sKathmandu%2C%20Nepal!5e0!3m2!1sen!2s!4v1234567890" width="100%" height="150" style="border:0; border-radius: 8px;" allowfullscreen="" loading="lazy"></iframe>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer Bottom -->
        <div class="footer-bottom">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <p class="mb-0">&copy; 2025 PawConnect. All rights reserved.</p>
                    </div>
                    <div class="col-md-6 text-md-end">
                        <a href="#">Privacy Policy</a>
                        <span class="mx-2">|</span>
                        <a href="#">Our History</a>
                        <span class="mx-2">|</span>
                        <a href="#">What We Do</a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Back to Top Button -->
    <a href="#" class="btn btn-theme btn-lg back-to-top" id="backToTop"><i class="fa-solid fa-arrow-up"></i></a>
    <!-- ChatBox Section -->
    {% comment %} <div id="chatboxIcon"
        style="position:fixed;bottom:30px;right:30px;z-index:1050;cursor:pointer;background: #20c997;color:#fff;border-radius:50%;width:60px;height:60px;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 8px rgba(0,0,0,0.2);">
        <i class="fa-solid fa-comments fa-2x"></i>
    </div>

    <!-- Chatbox Placeholder -->
    <div id="chatboxContainer"
        style="position:fixed;bottom:100px;right:30px;z-index:1060;width:320px;max-width:90vw;background:#fff;border-radius:12px;box-shadow:0 2px 16px rgba(0,0,0,0.25);display:none;flex-direction:column;">
        <div
            style="background:#20c997;color:#fff;padding:12px 16px;border-top-left-radius:12px;border-top-right-radius:12px;display:flex;align-items:center;justify-content:space-between;">
            <span><i class="fa-solid fa-comments"></i> Chat Support</span>
            <span id="closeChatbox" style="cursor:pointer;font-size:20px;">&times;</span>
        </div>
        <div style="padding:16px;flex:1;">
            <div id="chatMessages"
                style="height:250px;width:auto;font-size:14px;color:#333;margin-bottom:10px;background:#f7f7f7;border-radius:6px;padding:8px;">
                How can we help you?</div>
            <form id="chatForm" style="display:flex;">
                <input type="text" id="chatInput" class="form-control" placeholder="Type your message..."
                    style="flex:1;margin-right:8px;">
                <button type="submit" class="btn btn-theme">Send</button>
            </form>
        </div>
    </div> {% endcomment %}

    {% comment %} <!-- ChatBox Section -->
    <div id="chatboxIcon"
        style="position:fixed;bottom:30px;right:30px;z-index:1050;cursor:pointer;background: #20c997;color:#fff;border-radius:50%;width:60px;height:60px;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 8px rgba(0,0,0,0.2);">
        <i class="fa-solid fa-comments fa-2x"></i>
    </div> {% endcomment %}

 <!-- Chatbox Toggle Button -->
<div id="chat-toggle" class="chat-toggle" style="position:fixed!important;bottom:30px!important;right:30px!important;width:60px!important;height:60px!important;min-width:60px!important;max-width:60px!important;z-index:99999!important;border-radius:12px!important;background:linear-gradient(135deg,#20c997,#17a589)!important;display:flex!important;align-items:center!important;justify-content:center!important;cursor:pointer!important;color:#fff!important;font-size:1.4rem!important;left:auto!important;top:auto!important;margin:0!important;padding:0!important;">
  <i class="fa-solid fa-comments"></i>
</div>

<!-- Chat Window -->
<div id="chat-container" class="chat-container hidden" style="position:fixed!important;bottom:100px!important;right:30px!important;width:360px!important;max-width:360px!important;min-width:360px!important;height:480px!important;z-index:9998!important;border-radius:16px!important;background:#fff!important;box-shadow:0 12px 40px rgba(0,0,0,0.15)!important;flex-direction:column!important;overflow:hidden!important;border:1px solid #e2e8f0!important;left:auto!important;top:auto!important;margin:0!important;padding:0!important;">
    <!-- Header -->
    <div class="chat-header">
        <span><i class="fa-solid fa-robot"></i> PAW AI Assistant</span>
        <div style="display:flex;gap:15px;align-items:center;">
            <i class="fa-solid fa-trash-can" id="clear-chat-btn" style="cursor:pointer;font-size:1rem;transition:transform 0.2s;" title="Clear chat history"></i>
            <i class="fa-solid fa-times" id="close-chat-btn" style="cursor:pointer;font-size:1.2rem;transition:transform 0.2s;" title="Close chat"></i>
        </div>
    </div>

  <!-- Messages -->
  <div id="chat-box" class="chat-box">
    <div class="message bot">ðŸ‘‹ Hello! I'm PAW AI Assistant. How can I help you today?</div>
  </div>

  <!-- Input Area -->
  <form id="chatForm" class="input-container">
    <input type="text" id="user-input" placeholder="Type your message...">
    <button type="submit" id="send-btn"><i class="fa-solid fa-paper-plane"></i></button>
  </form>
</div>



    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>

        // Auto-dismiss toast notifications
        document.addEventListener('DOMContentLoaded', function() {
            var toastElList = [].slice.call(document.querySelectorAll('.toast'));
            var toastList = toastElList.map(function(toastEl) {
                var toast = new bootstrap.Toast(toastEl, {
                    autohide: true,
                    delay: 3000
                });
                toast.show();
                return toast;
            });
        });

        // Back to top button
        window.addEventListener('scroll', function() {
            var backToTop = document.getElementById('backToTop');
            if (window.pageYOffset > 300) {
                backToTop.classList.add('show');
            } else {
                backToTop.classList.remove('show');
            }
        });
        
        document.getElementById('backToTop').addEventListener('click', function(e) {
            e.preventDefault();
            window.scrollTo({top: 0, behavior: 'smooth'});
        });
        
        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });

// Ensure chat starts hidden
// document.addEventListener('DOMContentLoaded', function() {
//     document.getElementById('chat-container').classList.add('hidden');
// });

const API_URL = "http://127.0.0.1:8001/chat/"; // Backend URL
let conversationId = localStorage.getItem("conversationId") || "convo-" + Date.now();
localStorage.setItem("conversationId", conversationId);

// Load chat history on page load
window.addEventListener("DOMContentLoaded", () => {
  loadChatHistory();
});

// Save message to localStorage
function saveChatMessage(sender, text) {
  const chatHistory = JSON.parse(localStorage.getItem("chatHistory") || "[]");
  chatHistory.push({ sender, text, timestamp: Date.now() });
  // Keep only last 50 messages
  if (chatHistory.length > 50) {
    chatHistory.shift();
  }
  localStorage.setItem("chatHistory", JSON.stringify(chatHistory));
}

// Load chat history from localStorage
function loadChatHistory() {
  const chatHistory = JSON.parse(localStorage.getItem("chatHistory") || "[]");
  const chatBox = document.getElementById("chat-box");
  
  // Clear welcome message if there's history
  if (chatHistory.length > 0) {
    chatBox.innerHTML = "";
  }
  
  // Load all messages without animation
  chatHistory.forEach(msg => {
    appendMessage(msg.sender, msg.text, false);
  });
  
  chatBox.scrollTop = chatBox.scrollHeight;
}

// Clear chat history (optional function you can call)
function clearChatHistory() {
  localStorage.removeItem("chatHistory");
  localStorage.removeItem("conversationId");
  const chatBox = document.getElementById("chat-box");
  chatBox.innerHTML = '<div class="message bot">ðŸ‘‹ Hello! I\'m PAW AI Assistant. How can I help you today?</div>';
}

// Toggle chat window - ONLY on button click
const chatToggle = document.getElementById("chat-toggle");
const chatContainer = document.getElementById("chat-container");

// Open/Close chat when clicking the chat button
chatToggle.addEventListener("click", (e) => {
  e.stopPropagation();
  chatContainer.classList.toggle("hidden");
});

// Close chat when clicking the X button (use setTimeout to ensure DOM is ready)
setTimeout(() => {
  const closeBtn = document.getElementById("close-chat-btn");
  const clearBtn = document.getElementById("clear-chat-btn");
  
  if (closeBtn) {
    closeBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      e.preventDefault();
      chatContainer.classList.add("hidden");
      console.log("Chat closed via X button");
    });
    
    // Add hover effect to close button
    closeBtn.addEventListener("mouseenter", () => {
      closeBtn.style.transform = "rotate(90deg)";
    });
    
    closeBtn.addEventListener("mouseleave", () => {
      closeBtn.style.transform = "rotate(0deg)";
    });
  }
  
  if (clearBtn) {
    clearBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      e.preventDefault();
      if (confirm("Are you sure you want to clear the chat history?")) {
        clearChatHistory();
      }
    });
    
    // Add hover effect to clear button
    clearBtn.addEventListener("mouseenter", () => {
      clearBtn.style.transform = "scale(1.1)";
      clearBtn.style.color = "#ef4444";
    });
    
    clearBtn.addEventListener("mouseleave", () => {
      clearBtn.style.transform = "scale(1)";
      clearBtn.style.color = "#fff";
    });
  }
}, 100);

// Send button click
                document.getElementById("send-btn").addEventListener("click", function(e) {
                    e.preventDefault();
                    sendMessage();
                });
        
                // Form submit
                document.getElementById("chatForm").addEventListener("submit", function(e) {
                    e.preventDefault();
                    sendMessage();
                });

// Enter key press
document.getElementById("user-input").addEventListener("keypress", function (event) {
  if (event.key === "Enter") {
    event.preventDefault();
    sendMessage();
  }
});

async function sendMessage() {
  const input = document.getElementById("user-input");
  const userMessage = input.value.trim();
  if (!userMessage) return;

  appendMessage("user", userMessage);
  input.value = "";
  
  // Show typing indicator
  const typingIndicator = showTypingIndicator();

  try {
    const response = await fetch(API_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        message: userMessage,
        role: "user",
        conversation_id: conversationId
      })
    });

    const data = await response.json();
    
    // Remove typing indicator
    removeTypingIndicator(typingIndicator);
    
    if (response.ok) {
      appendMessage("bot", data.response);
    } else {
      appendMessage("bot", "âš ï¸ Error: " + data.detail);
    }
  } catch (error) {
    removeTypingIndicator(typingIndicator);
    appendMessage("bot", "âš ï¸ Server not reachable!");
  }
}

function showTypingIndicator() {
    const chatBox = document.getElementById("chat-box");
    const typingDiv = document.createElement("div");
    typingDiv.className = "typing-indicator";
    typingDiv.id = "typing-indicator";
    typingDiv.innerHTML = "<span></span><span></span><span></span>";
    chatBox.appendChild(typingDiv);
    chatBox.scrollTop = chatBox.scrollHeight;
    return typingDiv;
}

function removeTypingIndicator(indicator) {
    if (indicator && indicator.parentNode) {
        indicator.parentNode.removeChild(indicator);
    }
}

// Format bot response with markdown-like support
function formatBotResponse(text) {
    // Convert **bold** to <strong>
    text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
    
    // Convert *italic* to <em>
    text = text.replace(/\*(.*?)\*/g, '<em>$1</em>');
    
    // Convert numbered lists
    text = text.replace(/^\d+\.\s+(.+)$/gm, '<li>$1</li>');
    
    // Convert bullet points
    text = text.replace(/^[-â€¢]\s+(.+)$/gm, '<li>$1</li>');
    
    // Wrap consecutive <li> in <ul>
    text = text.replace(/(<li>.*<\/li>\s*)+/gs, '<ul>$&</ul>');
    
    // Convert line breaks to <br> but not inside <ul>
    text = text.replace(/\n(?![^<]*<\/ul>)/g, '<br>');
    
    return text;
}

// Typing animation for bot messages
async function typeMessage(element, text, speed = 30) {
    const formattedText = formatBotResponse(text);
    const tempDiv = document.createElement('div');
    tempDiv.innerHTML = formattedText;
    
    let currentIndex = 0;
    const plainText = tempDiv.textContent || tempDiv.innerText;
    
    // For simple text, use character-by-character typing
    if (formattedText === text) {
        for (let i = 0; i < text.length; i++) {
            element.textContent += text[i];
            
            // Scroll to bottom during typing
            const chatBox = document.getElementById("chat-box");
            chatBox.scrollTop = chatBox.scrollHeight;
            
            // Add pause for punctuation
            if (['.', '!', '?'].includes(text[i])) {
                await new Promise(resolve => setTimeout(resolve, 300));
            } else if ([',', ';', ':'].includes(text[i])) {
                await new Promise(resolve => setTimeout(resolve, 150));
            } else {
                await new Promise(resolve => setTimeout(resolve, speed));
            }
        }
    } else {
        // For formatted text, display it all at once after a short delay
        await new Promise(resolve => setTimeout(resolve, 500));
        element.innerHTML = formattedText;
    }
    
    const chatBox = document.getElementById("chat-box");
    chatBox.scrollTop = chatBox.scrollHeight;
}

function appendMessage(sender, text, animated = true) {
    const chatBox = document.getElementById("chat-box");
    const messageDiv = document.createElement("div");
    messageDiv.className = `message ${sender}`;
    
    if (sender === "user") {
        messageDiv.textContent = text;
        chatBox.appendChild(messageDiv);
        chatBox.scrollTop = chatBox.scrollHeight;
        saveChatMessage(sender, text);
    } else {
        // Bot message with typing animation
        chatBox.appendChild(messageDiv);
        
        if (animated) {
            typeMessage(messageDiv, text).then(() => {
                saveChatMessage(sender, text);
            });
        } else {
            // Load from history without animation
            const formattedText = formatBotResponse(text);
            if (formattedText !== text) {
                messageDiv.innerHTML = formattedText;
            } else {
                messageDiv.textContent = text;
            }
            chatBox.scrollTop = chatBox.scrollHeight;
        }
    }
}
    </script>
</html>